<html>
    <head>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js"></script>
        
        <script src="constants.js"></script>
        <script src="utils.js"></script>
        <script src="chart_by_ethnic.js"></script>
        <script src="chart_by_gender.js"></script>
        <script src="scatterplot.js"></script>
        <script src="diff_bar_chart.js"></script>

        <link rel="stylesheet" type="text/css" href="style.css"/>
    </head>

    <body onload="init()">
        <div class="row">
            <div id="main">
            </div>
        </div>

        <div class="row page1">
            <div class="content-header">
                <div class="content-header-text">
                    <h5>Undergraduate college enrollment by gender: Year 2020/21</h5>
                </div>
                <div class="content-header-navbar">
                    <div class="content-footer-button">
                        <input type="button" class="button-next" onclick="next()" value="Next" />
                    </div>
                </div>

            </div>
            <div class="content-text">
                <p>
                    According to US census data, the female population makes up 50.5% percent. 
                    Assuming this uniform distribution, we can reasonably expect a uniform gender distribution 
                    in the undergraduate student enrollment. 
                </p> 
                <p>
                    However, actual enrollment data shows that female undergraduate enrollment is 58% and 42% for male students.
                    This is a 15% increase of female enrollment from the normalized numbers. This is good news for women!
                    On the contrary, the significant gap of male students could be concerning. 
                    This may not be a big surprise, but should this be a concern?
                </p>
            </div>

            <div class="row content-chart">
                
                <div style="width:36%;">
                    <div>
                       
                        <div>
                            <table style="border: 0px; width: 100%">
                                <tr>
                                    <td colspan="2">
                                        <span style="font-size: 20px; font-weight: bold">Census: US population</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <img src="./images/male.png" style="width: 100px;"/>
                                    </td>
                                    <td>
                                        <img src="./images/female.jpg" style="width: 100px;"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span style="font-size: 20px; font-weight: bold">49.5%</span>
                                    </td>
                                    <td>
                                        <span style="font-size: 20px; font-weight: bold">50.5%</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="svg-container">
                        <svg id="svg-gender-summary2" class="svg-content" viewbox="0 0 400 200" preserveAspectRatio="xMinYMin meet">
                        </svg>
                    </div>
                </div>

                <div style="width:60%;">
                    <div class="svg-container">
                        <svg  id="svg-gender-summary" class="svg-content" viewbox="0 0 400 200" preserveAspectRatio="xMinYMin meet">
                        </svg>
                    </div> 
                </div>  
            </div>     

            <div class="disclaimer">
                <hr style="height: 3px; background-color: black;" />
                <span>
                    Main data source: <a href="https://collegescorecard.ed.gov/data" target="_blank">
                        https://collegescorecard.ed.gov/data (Instituation data 2021</a>
                    <br/>
                </span>
                <span>
                    Census data: <a href="https://www.census.gov/quickfacts/fact/table/US/PST045221" target="_blank">
                        (https://www.census.gov/quickfacts/fact/table/US/PST045221</a>
                </span>
            </div>
        </div>

        <div class="row page2">
            <div class="content-header">
                <h5>Undergraduate college enrollment gap by ethnic group: Year 2020/21</h5>

                <div class="content-header-navbar">
                    <div class="content-footer-button">
                        <input type="button" class="button-back" onclick="prev()" value="Back"/>
                    </div>
                    <div class="content-footer-button">
                        <input type="button" class="button-next" onclick="next()" value="Next" />
                    </div>
                </div>

            </div>  
            <div class="content-text">
                <p>
                    In this page we look at the undergraduate college enrollment data but by ethnic groups. 
                    As before, we are interested in the difference between the actual enrollment numbers
                    with the normalzed enrollment based on the ratio of the ethnic groups in the population.
                </p>
                <p>
                    American Indians show the largest percentage gap, followed by white, and black.
                    People with two or more race have better enrollment than their peers.
                </p>
                <p>
                   <b> Are your surprised? </b>
                </p>
            </div>

            <div class="row content-chart">
                <div style="width:48%;">
                    <div class="svg-container">
                        <svg id="svg-ethnic-summary2" class="svg-content" viewbox="0 0 400 200">
                        </svg>
                    </div>
                </div>
                <div style="width:48%;">
                    <div class="svg-container">
                        <svg  id="svg-ethnic-summary" class="svg-content" viewbox="0 0 400 200">
                        </svg>
                    </div> 
                </div>  
            </div>
        </div>

        <div class="row page3">
           <div class="content-header">
                <h5>Enrollment by ethnic group, SAT score, and college fee</h5>

                <div class="content-header-navbar">
                    <div class="content-footer-button">
                        <input type="button" class="button-back" onclick="prev()" value="Back"/>
                    </div>
                    <div class="content-footer-button">
                        <input type="button" class="button-next" onclick="next()" value="Next" />
                    </div>
                </div>

            </div>
            <div class="content-text">
                <p>
                   SAT score and college cost are key factors for getting into the college of choice for students. 
                   You can get intersting facts for the different ethnic groups. For example, most black students
                   enter into college with SAT score below 1200, which indicates problems with the high-school education.
                 </p>
                 <ul>
                    <li>SAT score is the average SAT score accepted by the institution.</li>
                    <li>Cost is the total cost of tuition, living expenes, textbooks, etc. after reduction Federal Pell grant, etc.</li>
                 </ul>
            </div>

            <div class="content-chart">
                <div class="content-chart-params">
                    <div class="content-chart-param">
                        <span class="label">Ethnicity </span>
                        <select id="ethnicDropdown" onchange="chartByEthnic()">
                        </select>   
                    </div>
                
                    <div class="content-chart-param">
                        <span class="label">State </span>
                        <select id="stateDropdown" onchange="chartByEthnic()">
                        </select>   
                    </div>

                    <div class="content-chart-param">
                        <span class="label">SAT score</span>
                        <select id="satDropdown" onchange="chartByEthnic()">
                        </select>  
                    </div>
                </div>

                <div style="width:80%;">
                    <div class="svg-container">
                        <svg id="svg-ethnic" class="svg-content" viewbox="0 0 400 200" preserveAspectRatio="xMinYMin meet">
                        </svg>
                    </div>
                </div>
                
            </div>      
        </div>

        <div class="row page4">
            <div class="content-header">
                <h5>Enrollment by gender, SAT score, and college fee</h5>

                <div class="content-header-navbar">
                    <div class="content-footer-button">
                        <input type="button" class="button-back" onclick="prev()" value="Back"/>
                    </div>
                    <div class="content-footer-button">
                        <input type="button" class="button-next" onclick="home()" value="Begin" />
                    </div>
                </div>
            </div>

            <div class="content-text">
                <p>Fortunately, we don't see a similar pattern by gender!
                    The data shows both male and female students spread accross a wide range of SAT
                    score and tuition cost. You can explore to see if this patterns holds for all states. 
                    Or, you can see see which colleges accept more male or female students.
                </p>
            </div>

            <div class="content-chart">
                <div class="content-chart-params">
                    <div class="content-chart-param">
                        <span class="label">Gender </span>
                        <select id="genderDropdown" onchange="chartByGender()">
                        </select>   
                    </div>

                    <div class="content-chart-param">
                        <span class="label">State </span>
                        <select id="stateDropdown2" onchange="chartByGender()">
                        </select>   
                    </div>
                    <div class="content-chart-param">
                        <span class="label">SAT </span>
                        <select id="satDropdown2" onchange="chartByGender()">
                        </select>  
                    </div>
                </div>
                        
                <div style="width:80%;">
                    <div class="svg-container">
                        <svg id="svg-gender" class="svg-content" viewbox="0 0 400 200" preserveAspectRatio="xMinYMin meet">
                        </svg>
                    </div>
                </div>

            </div>  
        </div>
             

        <script>
            var csv = null;
            var summaryByEthnic = null;
            var summaryByGender = null;

            const MAX_PAGES = 4;
            var curPage = 1;
         
            async function init() {
                
                // Setup page controls
                setupPage();

                // Update dropdown controls
                setupControls();

                var url = "https://bdigafe.github.io/data01.csv";
                csv = await d3.csv(url);

                // Get computed stats
                summaryByEthnic = getSummaryByEthnic(csv);
                summaryByGender = getSummaryByGender(csv);

                // Draw summary charts
                chartSummaryByEthnic(summaryByEthnic);
                chartSummaryByGender(summaryByGender);

                 // Draw interactive charts
                 d3.select("#ethnicDropdown").each(chartByEthnic);
                 d3.select("#genderDropdown").each(chartByGender);
            }

            function setupControls() {
                // Chart Controls: Ethnic
                setupDropdown("ethnicDropdown", EthnicNames, true);
                setupDropdown("stateDropdown", US_States, false);
                setupDropdownByRange("satDropdown", SAT_SCORE_MIN, SAT_SCORE_MAX, SAT_SCORE_STEP);
                d3.select("#ethnicDropdown").node().value=EthnicIds.black;

                // Chart controls: Gender
                setupDropdown("genderDropdown", GENDER_NAMES, true);
                setupDropdown("stateDropdown2", US_States, false);
                setupDropdownByRange("satDropdown2", SAT_SCORE_MIN, SAT_SCORE_MAX, SAT_SCORE_STEP);      
                var dropdownGender = d3.select("#genderDropdown")          
                dropdownGender.node().value=GenderIds.Male;
            }

            function chartByEthnic() {
                drawChartByEthnic("svg-ethnic", csv);
            }

            function chartByGender() {
                drawChartByGender("svg-gender", csv);
            }

            function chartSummaryByEthnic(data) {
                drawSummaryChartByEthnic("svg-ethnic-summary", data);
                drawSummaryChartByEthnicPie("svg-ethnic-summary2", data);
            }

            function chartSummaryByGender(data) {
                drawSummaryChartByGender("svg-gender-summary", data);
                drawSummaryChartByGenderPie("svg-gender-summary2", data);
            }

            // Hide/show all div contents based on the current page 
            function setupPage() {
                for (var i=1; i <= MAX_PAGES; i++) {
                    var pageClass = "page" + i;

                    if (i == curPage)
                        showontrols(pageClass);
                    else 
                        hideControls(pageClass);
                }
            }

            function hideControls(className) {
                [].forEach.call(document.querySelectorAll('.' + className), function (e) {
                        e.style.display = 'none';
                    });
            }

            function showontrols(className) {
                [].forEach.call(document.querySelectorAll('.' + className), function (e) {
                        e.style.display = '';
                    });
            }

            function prev() {
                if (curPage > 1) {
                    curPage--;
                    setupPage();
                }
            }

            function next() {
                if (curPage < MAX_PAGES) 
                    curPage++;
                else 
                    curPage=1;

                setupPage();
            }

            function home() {
                    curPage=1
                    setupPage();
            }
    </script>

    </body>
</html>