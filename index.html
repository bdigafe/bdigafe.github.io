<html>
    <head>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js"></script>
        
        <script src="constants.js"></script>
        <script src="utils.js"></script>
        <script src="chart_by_ethnic.js"></script>
        <script src="chart_by_gender.js"></script>
        <script src="scatterplot.js"></script>
        <script src="diff_bar_chart.js"></script>
        <script src="bar_chart.js"></script>

        <link rel="stylesheet" type="text/css" href="style.css"/>
    </head>

    <body onload="init()">
        <div class="row">
            <div id="main">
            </div>
        </div>

        <div class="row page1">
            <div class="content-header">
                <div class="content-header-text">
                    <h5>Undergraduate college enrollment by gender: Year 2020/21</h5>
                </div>
                <div class="content-header-navbar">
                   <span>Show data&nbsp;</span> 
                    <label class="switch">
                        <input class="show-data-checkbox" type="checkbox" onchange="toggleDataTable(this);">
                        <span class="slider round"></span>
                    </label>
                    <div class="content-footer-button">
                        <input type="button" class="button-next box" onclick="next()" value="Next" />
                    </div>
                </div>

            </div>
            <div class="content-text">
                <p>
                    According to US census data, the female population makes up 50.5% percent. 
                    Assuming this uniform distribution, we can expect a uniform gender distribution 
                    in the undergraduate student enrollment. However, actual enrollment of female students is 58% and 42% for male.
                    This is a 15% increase for female students from the normalized numbers. This is good news for women!
                    On the contrary, the significant gap of male students could be concerning. 
                </p>
            </div>

            <div class="row content-chart">
                <!--div class="svg-container">
                    <svg id="svg-gender-summary2" class="svg-content" viewbox="0 0 400 200" preserveAspectRatio="xMinYMin meet">
                    </svg>
                </div-->

                <div style="width:65%;">
                    <div class="svg-container">
                        <svg  id="svg-gender-summary" class="svg-content" viewbox="0 0 400 200" preserveAspectRatio="xMinYMin meet">
                        </svg>
                    </div> 
                </div>  

                <div style="width:32%;display: none;" class="table-data">
                    <table style="border: 0px; width: 100%;" id="data-table-gender">
                        <tbody>
                            <tr>
                                <td colspan="4">
                                    <span style="font-size: 20px; font-weight: bold">Census: US population</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span>Gender</span>
                                </td>
                                <td>
                                    <span>% US</span>
                                </td>
                                <td>
                                    <span>Enrollment</span>
                                </td>
                                <td>
                                    <span>Enrollment %</span>
                                </td>
                            </tr>   
                        </tbody>                    
                    </table>
                </div>
            </div>     
        </div>

        <div class="row page2">
            <div class="content-header">
                <h5>Undergraduate college enrollment gap by ethnic group: Year 2020/21</h5>

                <div class="content-header-navbar">
                    <span>Show data&nbsp;</span> 
                    <label class="switch">
                        <input class="show-data-checkbox" type="checkbox" onchange="toggleDataTable(this);">
                        <span class="slider round"></span>
                    </label>

                    <div class="content-footer-button">
                        <input type="button" class="button-back box" onclick="prev()" value="Back"/>
                    </div>
                    <div class="content-footer-button">
                        <input type="button" class="button-next box" onclick="next()" value="Next" />
                    </div>
                </div>

            </div>  
            <div class="content-text">
                <p>
                    The enrollment by ethnic group also shows grim results.
                    American Indians show the largest percentage gap, followed by white, and black.
                    People with two or more race have better enrollment than their peers.
                   <b> Are your surprised? </b>
                </p>
            </div>

            <div class="row content-chart">
                <div style="width:65%;">
                    <div class="svg-container">
                        <svg  id="svg-ethnic-summary" class="svg-content" viewbox="0 0 400 200">
                        </svg>
                    </div> 
                </div>  

                <div style="width:32%; display: none;" class="table-data">
                    <div>
                        <table style="border: 0px; width: 100%;" id="data-table-ethnic">
                            <tr>
                                <td colspan="4">
                                    <span style="font-size: 20px; font-weight: bold">Census: US population</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span>Ethnic group</span>
                                </td>
                                <td>
                                    <span>% US</span>
                                </td>
                                <td>
                                    <span>Enrollment</span>
                                </td>
                                <td>
                                    <span>Enrollment %</span>
                                </td>
                            </tr>
                        </table>
                    </div>

                <!--div class="svg-container">
                    <svg id="svg-gender-summary2" class="svg-content" viewbox="0 0 400 200" preserveAspectRatio="xMinYMin meet">
                    </svg>
                </div-->
                </div>
            </div>
        </div>

        <div class="row page3">
           <div class="content-header">
                <h5>Enrollment by ethnic group, SAT score, and college fee</h5>

                <div class="content-header-navbar">
                    <div class="content-footer-button">
                        <input type="button" class="button-back box" onclick="prev()" value="Back"/>
                    </div>
                    <div class="content-footer-button">
                        <input type="button" class="button-next box" onclick="next()" value="Next" />
                    </div>
                </div>

            </div>
            <div class="content-text">
                <p>
                   For most students, SAT score and college cost are key factors for getting into college of their choice. 
                   You can get intersting facts for the different ethnic groups. For example, most black students
                   enter into college with SAT score below 1200, which indicates problems with the high-school education.
                 </p>
            </div>

            <div class="content-chart">
                <div class="content-chart-params">
                    <div class="content-chart-param">
                        <span class="label">Ethnicity </span>
                        <select id="ethnicDropdown" onchange="chartByEthnic()">
                        </select>   
                    </div>
                
                    <div class="content-chart-param">
                        <span class="label">State </span>
                        <select id="stateDropdown" onchange="chartByEthnic()">
                        </select>   
                    </div>

                    <div class="content-chart-param">
                        <span class="label">SAT score</span>
                        <select id="satDropdown" onchange="chartByEthnic()">
                        </select>  
                    </div>
                </div>

                <div style="width:75%;">
                    <div class="svg-container">
                        <svg id="svg-ethnic" class="svg-content" viewbox="0 0 400 200" preserveAspectRatio="xMinYMin meet">
                        </svg>
                    </div>
                </div>
                
            </div>      
        </div>

        <div class="row page4">
            <div class="content-header">
                <h5>Enrollment by gender, SAT score, and college fee</h5>

                <div class="content-header-navbar">
                    <div class="content-footer-button">
                        <input type="button" class="button-back box" onclick="prev()" value="Back"/>
                    </div>
                    <div class="content-footer-button">
                        <input type="button" class="button-next box" onclick="home()" value="Begin" />
                    </div>
                </div>
            </div>

            <div class="content-text">
                <p>Fortunately, we don't see a similar pattern by gender!
                    The data shows both male and female students spread accross a wide range of SAT
                    score and tuition cost. You can explore to see if this patterns holds for all states. 
                    Or, you can see see which colleges accept more male or female students.
                </p>
            </div>

            <div class="content-chart">
                <div class="content-chart-params">
                    <div class="content-chart-param">
                        <span class="label">Gender </span>
                        <select id="genderDropdown" onchange="chartByGender()">
                        </select>   
                    </div>

                    <div class="content-chart-param">
                        <span class="label">State </span>
                        <select id="stateDropdown2" onchange="chartByGender()">
                        </select>   
                    </div>
                    <div class="content-chart-param">
                        <span class="label">SAT </span>
                        <select id="satDropdown2" onchange="chartByGender()">
                        </select>  
                    </div>
                </div>
                        
                <div style="width:75%;">
                    <div class="svg-container">
                        <svg id="svg-gender" class="svg-content" viewbox="0 0 400 200" preserveAspectRatio="xMinYMin meet">
                        </svg>
                    </div>
                </div>

            </div>  
        </div>
    
        <div class="disclaimer">
            <hr style="height: 3px; background-color: black;" />
            <span>
                Main data source: <a href="https://collegescorecard.ed.gov/data" target="_blank">
                    https://collegescorecard.ed.gov/data (Instituation data 2021</a>
                <br/>
            </span>
            <span>
                Census data: <a href="https://www.census.gov/quickfacts/fact/table/US/PST045221" target="_blank">
                    (https://www.census.gov/quickfacts/fact/table/US/PST045221</a>
            </span>
            <br/>
             <span>Notes:
                <li>SAT score is the average SAT score accepted by the institution.</li>
                <li>Cost is the total cost of tuition, living expenes, textbooks, etc. after reduction Federal Pell grant, etc.</li>
             </span>
        </div>

        <script>
            var csv = null;
            var summaryByEthnic = null;
            var summaryByGender = null;
            var showData = false;

            const MAX_PAGES = 4;
            var curPage = 1;
         
            async function init() {
                
                // Setup page controls
                setupPage();

                // Update dropdown controls
                setupControls();

                var url = "https://bdigafe.github.io/data01.csv";
                csv = await d3.csv(url);

                // Get computed stats
                summaryByEthnic = getSummaryByEthnic(csv);
                summaryByGender = getSummaryByGender(csv);

                 // Setup Ethnicity list
                setupDataTable("data-table-gender", summaryByGender);
                setupDataTable("data-table-ethnic", summaryByEthnic);

                // Draw summary charts
                chartSummaryByEthnic(summaryByEthnic);
                chartSummaryByGender(summaryByGender);

                 // Draw interactive charts
                 d3.select("#ethnicDropdown").each(chartByEthnic);
                 d3.select("#genderDropdown").each(chartByGender);
            }

            function setupControls() {
                // Chart Controls: Ethnic
                setupDropdown("ethnicDropdown", EthnicNames, true);
                setupDropdown("stateDropdown", US_States, false);
                setupDropdownByRange("satDropdown", SAT_SCORE_MIN, SAT_SCORE_MAX, SAT_SCORE_STEP);
                d3.select("#ethnicDropdown").node().value=EthnicIds.black;

                // Chart controls: Gender
                setupDropdown("genderDropdown", GENDER_NAMES, true);
                setupDropdown("stateDropdown2", US_States, false);
                setupDropdownByRange("satDropdown2", SAT_SCORE_MIN, SAT_SCORE_MAX, SAT_SCORE_STEP);      
                var dropdownGender = d3.select("#genderDropdown")          
                dropdownGender.node().value=GenderIds.Male;
            }

            function chartByEthnic() {
                drawChartByEthnic("svg-ethnic", csv);
            }

            function chartByGender() {
                drawChartByGender("svg-gender", csv);
            }

            function chartSummaryByEthnic(data) {
                drawSummaryChartByEthnic("svg-ethnic-summary", data);
                drawSummaryChartByEthnicPie("svg-ethnic-summary2", data);
            }

            function chartSummaryByGender(data) {
                drawSummaryChartByGender("svg-gender-summary", data);
                drawSummaryChartByGenderPie("svg-gender-summary2", data);
            }

            // Hide/show all div contents based on the current page 
            function setupPage() {
                for (var i=1; i <= MAX_PAGES; i++) {
                    var pageClass = "page" + i;

                    if (i == curPage)
                        showontrols(pageClass);
                    else 
                        hideControls(pageClass);
                }
            }

            function hideControls(className) {
                [].forEach.call(document.querySelectorAll('.' + className), function (e) {
                        e.style.display = 'none';
                    });
            }

            function showontrols(className) {
                [].forEach.call(document.querySelectorAll('.' + className), function (e) {
                        e.style.display = '';
                    });
            }

            function prev() {
                if (curPage > 1) {
                    curPage--;
                    setupPage();
                }
            }

            function next() {
                if (curPage < MAX_PAGES) 
                    curPage++;
                else 
                    curPage=1;

                setupPage();
            }

            function home() {
                    curPage=1
                    setupPage();
            }

            function setupDataTable(id, data) {
                var tr = d3.select("#" +id).selectAll(".tr-data")
                    .data(data)
                    .enter().append("tr")
                    .filter(function(d, i) { return i > 0 })

                tr.append("td")
                    .html(function(d) {return `<span>${d.label}</span>`; });

                tr.append("td")
                    .html(function(d) {return `<span>${(d.population*100).toFixed(2)}%</span>`});

                tr.append("td")
                    .html(function(d) {return `<span>${(d.adm_count).toLocaleString(0)}</span>`});

                tr.append("td")
                    .html(function(d) {return `<span>${(d.adm_percent * 100).toFixed(2)}%</span>`});

            }

            function toggleDataTable(src) {
               document.getElementsByClassName("table-data"); 
               var dataTables =  document.getElementsByClassName("table-data");
               showData= !showData;
               
               Array.prototype.filter.call(dataTables, function(e) {
                    if (showData) {
                            e.style.display = "block";
                     } else {
                            e.style.display = "none";
                     }
                 });

                 var switches = document.getElementsByClassName("show-data-checkbox");
                 Array.prototype.filter.call(switches, function(e) {
                    if (e != src)
                        e.checked = showData ? "on" : "off";
                 });

                 return true;
            }
    </script>

    </body>
</html>