<html>
    <head>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js"></script>
        
        <script src="constants.js"></script>
        <script src="utils.js"></script>
        <script src="chart_by_ethnic.js"></script>
        <script src="chart_by_gender.js"></script>
        <script src="scatterplot.js"></script>
        <script src="diff_bar_chart.js"></script>

        <link rel="stylesheet" type="text/css" href="style.css"/>
    </head>

    <body onload="init()">
        <div class="row">
            <div id="main">
            </div>
        </div>

        <div class="row page1">
            <div class="content-header">
                <h5>Undergruate college enrollment by gender (2021)</h5>
            </div>
            <div class="content-text">
                <p>
                    According to US census data, the female US population makes up 50.5% percent. 
                    Assuming this uniform distribution, we can reasonably expect the same distribution 
                    to be reflected in the undergraduate student enrollment. 
                </p> 
                <p>
                    Actual enrollment data shows that female undergraduate enrollment, across all the United States, is about 58%.
                    This is a 15% from the normalized enrollment amount. This is a good news for women.
                    However, the lag of the male population should be a concern with huge ramifications.
                </p>
            </div>

            <div class="content-chart">
                <div style="width:48%;">
                    <div class="svg-container">
                        <svg id="svg-gender-summary2" class="svg-content" viewBox="0 0 300 175">
                        </svg>
                    </div>
                </div>
                <div style="width:48%;">
                    <div> class="svg-container">
                        <svg  id="svg-gender-summary" class="svg-content" viewBox="0 0 300 175">
                        </svg>
                    </div> 
                </div>         
            </div>     
            <div class="content-footer">
                <div class="content-footer-button">
                    <input type="button" class="button-next" onclick="next()" value="Next" />
                </div>
            </div>
            <div class="disclaimer">
                <span>
                    Main data: <a href="https://collegescorecard.ed.gov/data" arget="_blank">
                        https://collegescorecard.ed.gov/data (Instituation data 2021</a>
                    <br/>
                </span>
                <span>
                    Census data: <a href="https://www.census.gov/quickfacts/fact/table/US/PST045221" target="_blank">
                        (https://www.census.gov/quickfacts/fact/table/US/PST045221</a>
                </span>
            </div>

        </div>

        <div class="row page2">
            <div class="content-header">
                <h5>Undergraduate college enrollment gap by ethnic group (2021)</h5>
            </div>  
            <div>
                <p>
                    In this page we look at the undergraduate college enrollment data but by ethnic groups. 
                    As before, we are interested in the difference between the actual enrollment numbers
                    with the normalzed enrollment based on the ratio of the ethnic groups in the population.
                </p>
                <p>
                    American Indians show the largest percentage gap, followed by white, and black.
                    People with two or more race have better enrollment than their peers.
                </p>
            </div>

            <div class="content-chart">
                <div style="width:48%;">
                    <svg  id="svg-ethnic-summary2" viewBox="0 0 300 175">
                    </svg>
                </div>
                <div style="width:48%;">
                    <svg width=600 height=350 id="svg-ethnic-summary">
                    </svg>
                </div> 
            </div>  

            <div class="content-footer">              
                <div class="content-footer-button">
                    <input type="button" class="button-back" onclick="prev()" value="Back"/>
                </div>
                <div class="content-footer-button">
                    <input type="button" class="button-next" onclick="next()" value="Next" />
                </div>
            </div>      
        </div>

        <div class="row page3">
           <div class="content-header">
                <h5>Enrollment by ethnic group, SAT score, and college fee</h5>
            </div>
            <div class="content-text">
                <p>
                    Curious where are studennts going based on SAT score, cost of attending college, or ethnic group?
                 </p>
                 <ul>
                    <li>SAT score: It the average SAT score accepted by the Instituation.</li>
                    <li>Cost is the tuition, living, textbooks, etc. after reduction Federal Pell grant, etc.</li>
                 </ul>
            </div>

            <div class="content-chart">
                <div class="content-chart-params">
                    <div class="content-chart-param">
                        <span class="label">Ethnicity </span>
                        <select id="ethnicDropdown" onchange="chartByEthnic()">
                        </select>   
                    </div>
                
                    <div class="content-chart-param">
                        <span class="label">State </span>
                        <select id="stateDropdown" onchange="chartByEthnic()">
                        </select>   
                    </div>

                    <div class="content-chart-param">
                        <span class="label">SAT score</span>
                        <select id="satDropdown" onchange="chartByEthnic()">
                        </select>  
                    </div>
                </div>
                <svg id="svg-ethnic" viewBox="0 0 800 400" width="100%">
                </svg>  
            </div>

            <div class="content-footer">
                <div class="content-footer-button">
                    <input type="button" class="button-back" onclick="prev()" value="Back"/>
                </div>
                <div class="content-footer-button">
                    <input type="button" class="button-next" onclick="next()" value="Next" />
                </div>
            </div>      
        </div>

        <div class="row page4">
            <div class="content-header">
                <h5>Gender enrollment by SAT score and college fee</h5>
            </div>

            <div class="content">
                <p>
                    We have also similar data based on gender!
                    Note that the cost or SAT are the average per the college and it does not reflect a 
                    particular student!
                </p>
            </div>

            <div class="content-chart">
                <div class="content-chart-params">
                    <div class="content-chart-param">
                        <span class="label">Gender </span>
                        <select id="genderDropdown" onchange="chartByGender()">
                        </select>   
                    </div>

                    <div class="content-chart-param">
                        <span class="label">State </span>
                        <select id="stateDropdown2" onchange="chartByGender()">
                        </select>   
                    </div>
                    <div class="content-chart-param">
                        <span class="label">SAT </span>
                        <select id="satDropdown2" onchange="chartByGender()">
                        </select>  
                    </div>
                </div>
                <div class="content-chart-chart">
                    <svg id="svg-gender" viewBox="0 0 800 400" width="100%">
                    </svg>  
                </div>
            </div>

            <div class="content-footer">
                <div class="content-footer-button">
                    <input type="button" class="button-back" onclick="prev()" value="Back"/>
                </div>
            </div>      
        </div>
             

        <script>
            var csv = null;
            var summaryByEthnic = null;
            var summaryByGender = null;

            const MAX_PAGES = 4;
            var curPage = 1;
         
            async function init() {
                
                // Setup page controls
                setupPage();

                // Update dropdown controls
                setupControls();

                var url = "https://bdigafe.github.io/data01.csv";
                //var url = "http://localhost/viz416/data01.csv";
                csv = await d3.csv(url);

                // Get computed stats
                summaryByEthnic = getSummaryByEthnic(csv);
                summaryByGender = getSummaryByGender(csv);

                // Draw summary charts
                chartSummaryByEthnic(summaryByEthnic);
                chartSummaryByGender(summaryByGender);

                 // Draw interactive charts
                 d3.select("#ethnicDropdown").each(chartByEthnic);
                 d3.select("#genderDropdown").each(chartByGender);
            }

            function setupControls() {
                // Chart Controls: Ethnic
                setupDropdown("ethnicDropdown", EthnicNames, true);
                setupDropdown("stateDropdown", US_States, false);
                setupDropdownByRange("satDropdown", SAT_SCORE_MIN, SAT_SCORE_MAX, SAT_SCORE_STEP);
                d3.select("#ethnicDropdown").node().value=EthnicIds.black;

                // Chart controls: Gender
                setupDropdown("genderDropdown", GENDER_NAMES, true);
                setupDropdown("stateDropdown2", US_States, false);
                setupDropdownByRange("satDropdown2", SAT_SCORE_MIN, SAT_SCORE_MAX, SAT_SCORE_STEP);      
                var dropdownGender = d3.select("#genderDropdown")          
                dropdownGender.node().value=GenderIds.Male;
            }

            function chartByEthnic() {
                drawChartByEthnic("svg-ethnic", csv);
            }

            function chartByGender() {
                drawChartByGender("svg-gender", csv);
            }

            function chartSummaryByEthnic(data) {
                drawSummaryChartByEthnic("svg-ethnic-summary", data);
                drawSummaryChartByEthnicPie("svg-ethnic-summary2", data);
            }

            function chartSummaryByGender(data) {

                var svg = d3.select("svg")
                    .attr("preserveAspectRatio", "xMinYMin meet")
                    .attr("viewBox", "0 0 300 175")
                    .classed("svg-content", true);
                
                drawSummaryChartByGender("svg-gender-summary", data);
                drawSummaryChartByGenderPie("svg-gender-summary2", data);


            }

            // Hide/show all div contents based on the current page 
            function setupPage() {
                for (var i=1; i <= MAX_PAGES; i++) {
                    var pageClass = "page" + i;

                    if (i == curPage)
                        showontrols(pageClass);
                    else 
                        hideControls(pageClass);
                }
            }

            function hideControls(className) {
                [].forEach.call(document.querySelectorAll('.' + className), function (e) {
                        e.style.display = 'none';
                    });
            }

            function showontrols(className) {
                [].forEach.call(document.querySelectorAll('.' + className), function (e) {
                        e.style.display = '';
                    });
            }

            function prev() {
                if (curPage > 1) {
                    curPage--;
                    setupPage();
                }
            }

            function next() {
                if (curPage < MAX_PAGES) 
                    curPage++;
                else 
                    curPage=1;

                setupPage();
            }
            
    </script>

    </body>
</html>